import shapefile
from pygeoif import geometry

"""
data = [
    [38.861164455523, -77.4728393554688],
    [38.8619998713995, -77.4670457839966],
    [38.8574550904945, -77.4666166305542],
    [38.8579229489991, -77.4706506729126],
    [38.8593265060448, -77.4732685089111],
    [38.861164455523, -77.4728393554688]
]
new_data = [
    [38.8609639542521, -77.4471759796143],
    [38.8588252388515, -77.4385070800781],
    [38.8502697340142, -77.4397945404053],
    [38.8502697340142, -77.4397945404053],
    [38.8519408119263, -77.4490642547607],
    [38.8609639542521, -77.4471759796143]
]
"""
data1 = 'POLYGON Z ((38.861164455523 -77.4728393554688, 38.8619998713995 -77.4670457839966, 38.8574550904945 -77.4666166305542, 38.8579229489991 -77.4706506729126, 38.8593265060448 -77.4732685089111, 38.861164455523 -77.4728393554688))'
    
data2 = 'POLYGONZ((38.8609639542521 -77.4471759796143, 38.8588252388515 -77.4385070800781, 38.8502697340142 -77.4397945404053, 38.8502697340142 -77.4397945404053, 38.8519408119263 -77.4490642547607, 38.8609639542521 -77.4471759796143))'

def format(data):
    return 'POLYGONZ'+str(data)
try:
    from StringIO import StringIO
except ImportError:
    from io import BytesIO as StringIO
shp = StringIO()

filename = 'test.shp'
geometries = [
    data1,
    data2
]
w = shapefile.Writer('./'+filename, shp=shp, shapeType=shapefile.POLYGONZ)
w.field('test', 'N')
for i,poly in enumerate(geometries):
    w.poly([geometry.from_wkt(poly).exterior.coords])
    w.record(i)
w.save(filename)
w.null()
w.close()
